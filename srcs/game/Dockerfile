FROM python:3.9-bookworm
COPY deps/requirements.txt /app/
RUN pip install -r /app/requirements.txt

LABEL Author="Sarah Hicham Meftah"
LABEL Container="Game Server"

ARG DB_NAME
ARG DB_USER
ARG DB_PASSWORD
ARG DB_HOST
ARG DB_PORT
ARG SECRET_KEY
ARG CLIENT_ID
ARG CLIENT_SECRET
ARG EMAIL_API_KEY
ARG EMAIL_DOMAIN
ARG HOST_ADDRESS
ARG AUTH_PORT
ARG USERMGR_PORT
ARG GAME_PORT


ENV DB_NAME=${DB_NAME}
ENV DB_USER=${DB_USER}
ENV DB_PASSWORD=${DB_PASSWORD}
ENV DB_HOST=${DB_HOST}
ENV DB_PORT=${DB_PORT}
ENV SECRET_KEY=${SECRET_KEY}
ENV CLIENT_ID=${CLIENT_ID}
ENV CLIENT_SECRET=${CLIENT_SECRET}
ENV EMAIL_API_KEY=${EMAIL_API_KEY}
ENV EMAIL_DOMAIN=${EMAIL_DOMAIN}
ENV HOST_ADDRESS=${HOST_ADDRESS}
ENV AUTH_PORT=${AUTH_PORT}
ENV USERMGR_PORT=${USERMGR_PORT}
ENV GAME_PORT=${GAME_PORT}

ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1

COPY GameService/ /app/
COPY tools/entrypoint.sh /app/

WORKDIR /app

COPY certs/10.11.248.159.crt ./$HOST_ADDRESS.crt
COPY certs/10.11.248.159.key ./$HOST_ADDRESS.key


ENTRYPOINT [ "bash", "entrypoint.sh" ]
